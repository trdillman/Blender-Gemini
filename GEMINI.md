# Blender Gemini Assistant Pro - Project Context

## 1. Project Overview
This project is a **hybrid AI Assistant** that integrates a **React-based Web Application** with **Blender 4.5+** via a local Python bridge. It uses Google's Gemini 2.5/3.0 models to control Blender, generate geometry nodes, and write Python scripts through a strict "Verify & Fix" agent loop.

**Architecture:**
*   **Frontend (The Brain):** React 19, Vite, TypeScript, Tailwind CSS, Lucide React.
*   **Backend (The Body):** A Python script (`gemini_bridge.py.txt`) running inside Blender as a threaded HTTP server (default port 8081).
*   **Communication:** The frontend sends HTTP requests to the local Blender server using a security token for authentication.

## 2. Key Files & Directories

*   **`gemini_bridge.py.txt`**: The single-file Python addon. **Critical:** Any changes here require the user to manually reload the script in Blender.
*   **`hooks/useGeminiAgent.ts`**: Contains the core recursive agent logic (Stream -> Tool Call -> Execution -> Recursion).
*   **`hooks/useBlender.ts`**: Handles HTTP communication with the Blender Python server.
*   **`utils/tools.ts`**: Definitions of tools available to the Gemini model (e.g., `inspect_graph`, `get_screenshot`).
*   **`types.ts`**: TypeScript interfaces. **Must match** the JSON output structure from `gemini_bridge.py.txt`.
*   **`AGENT_PROTOCOL.md`**: Instructions for the AI model regarding its environment and constraints.
*   **`DEVELOPMENT.md`**: Guide for developers on architecture and workflows.

## 3. Development Workflow

### Frontend
1.  **Install Dependencies:** `npm install`
2.  **Run Development Server:** `npm run dev`
3.  **Build:** `npm run build`

### Backend (Blender)
1.  Open `gemini_bridge.py.txt`.
2.  Copy content to Blender's Scripting tab.
3.  Run the script.
4.  Start the server from the "Gemini" tab in the 3D Viewport Sidebar (N-Panel).

### Environment Variables
*   `GEMINI_API_KEY`: Required for the AI model (set in `.env.local`).

## 4. Coding Conventions

*   **TypeScript:** Strict typing. Ensure `types.ts` is updated when changing API responses.
*   **Python:**
    *   Use `bpy` context safely.
    *   Handle threading carefully (the bridge uses `bpy.app.timers` to offload to the main thread).
    *   **Serialization:** Ensure `GraphSerializer` in Python matches `GraphData` in TypeScript.
*   **Agent Behavior:**
    *   **Inspect First:** The agent should inspect the graph before making changes.
    *   **Verify:** The agent must verify its actions (e.g., read back the graph) and fix errors autonomously.
    *   **Context:** The agent has no visual eyes unless it requests a screenshot.

## 5. Tools & Capabilities

*   `inspect_graph`: Returns the JSON representation of the active Geometry Node tree.
*   `execute_code`: Runs Python code in Blender.
*   `get_screenshot`: captures the 3D viewport.
*   `remember`: Saves user preferences/facts to long-term memory.

## 6. Safety & Security
*   **Tokens:** Communication is secured via a one-time token generated by the Python script and passed to the frontend URL.
*   **Sandboxing:** Python execution happens locally on the user's machine; ensure generated code is safe.
